<ion-header [translucent]="true">
  <ion-toolbar class="gradient-background main-toolbar">
    <div class="header-column">
      <ion-text class="font-secondary active-color header-title">
        Pokemon
      </ion-text>

      <ion-searchbar class="pill-search font-secondary" placeholder="Search" show-clear-button="never"
        inputmode="search">
      </ion-searchbar>
    </div>
  </ion-toolbar>
</ion-header>



<ion-content [fullscreen]="true">
  <ion-list>
    @for (p of pokemons; track p.url) {
    <ion-item (click)="showDetail(true, p)">
      <div class="pokemon-image">
        <img [src]="getOfficialArtworkUrl(p.id)" [alt]="p.name" loading="lazy" />
      </div>

      <div class="info-item">
        <ion-label class="font-primary pokemon-text">
          {{ p.name | titlecase }}
        </ion-label>

        <ion-note class="font-primary pokemon-text">
          {{ formatId3(p.id) }}
        </ion-note>
      </div>

      <div class="pokemon-types">
        @for (t of p.types; track t) {
        <img class="type-icon" [src]="getTypeIconUrl(t)" [alt]="t" />
        }
      </div>
    </ion-item>
    }
  </ion-list>

  <ion-infinite-scroll (ionInfinite)="onIonInfinite($event)" threshold="100px" [disabled]="allLoaded">
    <ion-infinite-scroll-content loadingSpinner="bubbles" loadingText="Loading..."></ion-infinite-scroll-content>
  </ion-infinite-scroll>


  <ion-modal [isOpen]="isDetailOpen" cssClass="pokemon-detail-modal">
    <ng-template>
      <ion-content class="detail-bg">

        <!-- Header flotante -->
        <ion-toolbar class="detail-toolbar">
          <ion-buttons slot="start">
            <ion-button fill="clear" (click)="showDetail(false)">
              <ion-icon name="chevron-down-outline"></ion-icon>
            </ion-button>
          </ion-buttons>
        </ion-toolbar>

        <!-- Imagen -->
        <div class="artwork-wrap">
          <ion-img class="artwork" [src]="getOfficialArtworkUrl(pokemonSelected?.id || 0)"></ion-img>
        </div>

        <!-- Card blanca -->
        <div class="sheet">

          <ion-text class="font-secondary name">
            {{ pokemonSelected?.name | titlecase }}
          </ion-text>

          <!-- Tipo -->
          <div class="type-row">
            @for (t of pokemonSelected?.types; track t) {
            <ion-chip color="dark">
              <ion-label>{{ t | uppercase }}</ion-label>
            </ion-chip>
            }
          </div>

          <!-- Descripcion -->
          <ion-text class="desc font-secondary">
            {{ pokemonDetail?.description }}
          </ion-text>

          <!-- Tabs (Angular Material) -->
          <mat-tab-group class="detail-tabs" [(selectedIndex)]="selectedTabIndex">

            <mat-tab label="STATS">
              <!-- Stats (Ionic, sin cambios) -->
              <ion-list class="stats-list">
                <ion-item class="stats-item">
                  <ion-label class="stats-label">HP</ion-label>
                  <ion-note class="stats-note" slot="end">{{ pokemonDetail?.stats?.hp ?? 0 }}</ion-note>
                  <ion-progress-bar class="stats-bar"
                    [value]="(pokemonDetail?.stats?.hp ?? 0) / maxStat"></ion-progress-bar>
                </ion-item>

                <ion-item class="stats-item">
                  <ion-label class="stats-label">ATK</ion-label>
                  <ion-note class="stats-note" slot="end">{{ pokemonDetail?.stats?.attack ?? 0 }}</ion-note>
                  <ion-progress-bar class="stats-bar"
                    [value]="(pokemonDetail?.stats?.attack ?? 0) / maxStat"></ion-progress-bar>
                </ion-item>

                <ion-item class="stats-item">
                  <ion-label class="stats-label">DEF</ion-label>
                  <ion-note class="stats-note" slot="end">{{ pokemonDetail?.stats?.defense ?? 0 }}</ion-note>
                  <ion-progress-bar class="stats-bar"
                    [value]="(pokemonDetail?.stats?.defense ?? 0) / maxStat"></ion-progress-bar>
                </ion-item>

                <ion-item class="stats-item">
                  <ion-label class="stats-label">SATK</ion-label>
                  <ion-note class="stats-note" slot="end">{{ pokemonDetail?.stats?.specialAttack ?? 0 }}</ion-note>
                  <ion-progress-bar class="stats-bar"
                    [value]="(pokemonDetail?.stats?.specialAttack ?? 0) / maxStat"></ion-progress-bar>
                </ion-item>

                <ion-item class="stats-item">
                  <ion-label class="stats-label">SDEF</ion-label>
                  <ion-note class="stats-note" slot="end">{{ pokemonDetail?.stats?.specialDefense ?? 0 }}</ion-note>
                  <ion-progress-bar class="stats-bar"
                    [value]="(pokemonDetail?.stats?.specialDefense ?? 0) / maxStat"></ion-progress-bar>
                </ion-item>

                <ion-item class="stats-item">
                  <ion-label class="stats-label">SPD</ion-label>
                  <ion-note class="stats-note" slot="end">{{ pokemonDetail?.stats?.speed ?? 0 }}</ion-note>
                  <ion-progress-bar class="stats-bar"
                    [value]="(pokemonDetail?.stats?.speed ?? 0) / maxStat"></ion-progress-bar>
                </ion-item>
              </ion-list>
            </mat-tab>

            <mat-tab label="EVOLUTIONS">
              <div class="tab-content">
                <p>evoluciones</p>
              </div>
            </mat-tab>

            <mat-tab label="MOVES">
              <div class="tab-content">
                <p>movimientos</p>
              </div>
            </mat-tab>

          </mat-tab-group>
        </div>
      </ion-content>
    </ng-template>
  </ion-modal>
</ion-content>

<app-navbar></app-navbar>